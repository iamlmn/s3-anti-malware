import os
import clamd
from io import BytesIO
os.system('service clamav-daemon start')
cd = clamd.ClamdUnixSocket()
pong = cd.ping()


print('Using {}'.format(cd.version()))


def scan_file(file):
    '''
    Scan a file with Clam AV
    '''
    results = cd.scan(file)

    return results[str(file)][0],results[str(file)][1]




def scan_stream(file_stream):
    '''
    Scan a file with Clam AV
    '''

    # open('/tmp/EICAR','wb').write(clamd.EICAR)
    results = cd.instream(BytesIO(file_stream))

    return results[str(file)][0],results[str(file)][1]


if __name__ == "__main__":
    file_path='test/test_clean_file.json'
    dir_path = os.path.dirname(os.path.realpath(file_path))
    file = os.path.basename(file_path)
    AV_STATUS,AV_SIGN = scan_file(os.path.join(dir_path,file))
    print(AV_STATUS)    


